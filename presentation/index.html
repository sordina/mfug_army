<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>Haskell Army - Commando and Conscript</title>
		<meta name="description" content="Haskell Army - Commando and Conscript">
		<meta name="author" content="Lyndon Maydwell">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">
		<link rel="stylesheet" href="css/extra.css" id="theme">
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<script>
			  document.write( '<link rel="stylesheet" href="css/print/'
			+ ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' )
			+ '.css" type="text/css" media="print">' );
		</script>
	</head>

	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h1>Haskell Army</h1>
					<h3 class="fragment"> &gt;&gt;&gt; Commando and Conscript</h3>
					<br>
					<br>
					<div class="fragment">
						<p> <small>Created by Lyndon Maydwell (<a href="mailto:maydwell@gmail.com">maydwell@gmail.com</a>) </small> </p>
						<p> <small>Presentation: <a href="http://sordina.github.io/mfug_army">http://sordina.github.io/mfug_army</a>
							(presented with <a href="http://lab.hakim.se/reveal-js">reveal.js</a>)</small> </p>
						<p> <small>Github: <a href="https://github.com/sordina/mfug_army">https://github.com/sordina/mfug_army</a></small> </p>
					</div>
				</section>

				<section>
					<section>
						<h2>What's all this then?</h2>

						<br />
						<br />
						<p class="fragment"> Just writing some real-world code in Haskell <p>
						<p class="fragment"> Nothing drastic <p>
					</section>

					<section>
						<h2>But what did you done?</h2>

						<div class="fragment">
							<p> <small> I wanted to create something similar to Watch [1], </small> </p>
							<p> <small> with advanced features like Ruby's Guard [2] ... </small> </p>
							<p> <small> but without any language dependencies.  Just plain binaries... </small> </p>
							<p> <small> decoupled into cooperating programs. </small> </p>

							<blockquote>
								<small>
								<ol>
									<li><a href="http://en.wikipedia.org/wiki/Watch_(Unix)">http://en.wikipedia.org/wiki/Watch_(Unix)</a></li>
									<li><a href="https://github.com/guard/guard">https://github.com/guard/guard</a></li>
								</ol>
								</small>
							</blockquote>
						</div>
					</section>

					<section>
						<div style="text-align: left;">
								<code>~/Documents/Code echo {Conscript,Commando}/*.hs \
									<br />| xargs -n 1 echo \
									<br />| grep -v Setup \
									<br />| xargs cat
									<br />| wc -l
								</code>
						</div>
						<h2 class="fragment">145</h2>
					</section>
				</section>


				<section>
					<section>
						<h2>The UNIX Philosophy</h2>

						<p><a href="http://en.wikipedia.org/wiki/Unix_philosophy">http://en.wikipedia.org/wiki/Unix_philosophy</a></p>

						<blockquote>
							<ul>
								<li>Small is beautiful.</li>
								<li>Make each program do one thing well.</li>
								<li>Build a prototype as soon as possible.</li>
								<li>Choose portability over efficiency.</li>
								<li>Store data in flat text files.</li>
								<li>Use software leverage to your advantage.</li>
								<li>Use shell scripts to leverage and port.</li>
								<li>Avoid captive user interfaces.</li>
								<li>Make every program a filter.</li>
							</ul>
						</blockquote>
					</section>
				</section>

				<section>
					<section>
						<h1> Commando </h1>
						<img src="http://sordina.binaries.s3.amazonaws.com/commando.png" />
						<p><a href="https://github.com/sordina/Commando">github.com/sordina/Commando</a></p>
					</section>

					<section>
						<h2> What is Commando? </h2>
						<ul>
							<li class="fragment">Watch a directory</li>
							<li class="fragment">Perform an action when files change</li>
							<li class="fragment">Simple right?</li>
						</ul>
					</section>

					<section>
						<iframe width="420" height="315" src="http://www.youtube.com/embed/9cH-jQ83Mg4" frameborder="0" allowfullscreen></iframe>
					</section>

					<section>
						<h2>Commando's Arsenal</h2>
						<br />
						<code><pre>
				build-depends:
					base,
					text,
					system-filepath,
					<span style="background:green;">optparse-applicative,</span>
					system-fileio,
					<span style="background:red;"  >fsnotify &gt;= 0.0.13,</span>
					process
						</pre></code>
					</section>

					<section>
						<h2>FSNotify</h2>
						<p><a href="https://github.com/mdittmer/hfsnotify">github.com/mdittmer/hfsnotify</a></p>
						<br />
						<ul>
							<li class="fragment">Cross-Platform filesystem-notification project</li>
							<li class="fragment">Developed as a Google Summer of Code Project</li>
						</ul>
					</section>

					<section>
						<h2>Optparse-Applicative</h2>
						<p><a href="https://github.com/pcapriotti/optparse-applicative">github.com/pcapriotti/optparse-applicative</a></p>
						<br />
						<ul>
							<li class="fragment">Composable (command-line) options parsing library</li>
							<li class="fragment">Applicative interface</li>
							<li class="fragment">Pure and impure top-level interfaces(!)</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h1> Conscript </h1>
						<img src="http://sordina.binaries.s3.amazonaws.com/conscript.png" />
						<p><a href="https://github.com/sordina/Conscript">github.com/sordina/Conscript</a></p>
					</section>

					<section>
						<h2>What is Conscript? </h2>
						<ul>
							<li class="fragment">Run a command</li>
							<li class="fragment">(Re)start the command on lines of STDIN</li>
							<li class="fragment">Simple right?</li>
						</ul>
					</section>

					<section>
						<iframe width="420" height="315" src="http://www.youtube.com/embed/sUEBwzhDC4M" frameborder="0" allowfullscreen></iframe>
					</section>

					<section>
						<h2>Conscript's Rifle</h2>
						<br />
						<code><pre>
				build-depends:
					base ==4.6.*,
					<span style="background: green;">process ==1.1.*</span>
						</pre></code>
					</section>
				</section>

        <section>
          <h1> Neat! </h1>
          <h2 class="fragment"> Now show me the codez! </h2>
        </section>

				<section>
					<section>
						<h1> Optparse </h1>
						<h1> Applicative </h1>
          </section>
					
					<section>
						<h2> Parser Definition </h2>

						<div class="left">
							<code>
								<div class="fragment">
									import Options.Applicative <br />
									import Data.Monoid ((<>)) <br />
									<br />
								</div>
								<div class="fragment">
									quietFlag = short 'q' <br />
									quietHelp = help "silence the output" <br />
									quietOption = switch ( quietFlag &lt;&gt; quietHelp ) <br />
									<br />
								</div>
								<div class="fragment">
									data Options = Opts {quiet :: Bool} <br />
									<br />
								</div>
								<div class="fragment">
									optParser :: Parser Options <br />
									optParser = Opts <$> quietOption <br />
								</div>
							</code>
						</div>
					</section>

					<section>
						<h2> Pure Usage </h2>

            <!--
      optParser :: Parser Options
      optParser = Opts &lt;$&gt; quietOption
        where quietFlag   = short 'q'
              quietHelp   = help "silence the output"
              quietOption = switch ( quietFlag &lt;&gt; quietHelp )
              -->

						<div class="left fragment">
								<code>
									<pre>
      import Options.Applicative
      import Data.Monoid (mempty)
      import Options.Applicative.Types (ParserPrefs)

      data Options = Opts {quiet :: Bool} deriving Show

      pureParser :: (Parser a) -&gt; [String] -&gt; Maybe a
      pureParser parser = eitherToMaybe . execParserPure preferences information
        where information   = (info parser mempty)
              preferences   = prefs mempty
              eitherToMaybe = either (const Nothing) Just

      main :: IO ()
      main = do print $ pureParser optParser (words "-q")
                print $ pureParser optParser (words "I do what I want!")
									</pre>
								</code>
						</div>
					</section>

					<section>
						<h2> Impure Usage </h2>

						<div class="left fragment">
							<code>
								main :: IO () <br />
								main = execParser
								<br /> &nbsp;&nbsp; (info (helper &lt;*&gt; options) mempty)
								<br /> &nbsp;&nbsp; &gt;&gt;= start <br />
								<br />
								start :: Options -&gt; IO () <br />
								start = ...
							</code>
						</div>
					</section>

					<section>
						<h2> Any freebies? </h2>

						<div class="left fragment">
							<code>
								<small>
									lyndon@endpin ~ commando --help
									<br /> Usage: commando [COMMAND] [-q|--quiet] [-c|--consumer] [-i|--stdin] [-p|--persist] [DIRECTORY]
									<br />
									<br /> Available options:
									<br /> &nbsp;&nbsp;  -h,--help                Show this help text
									<br /> &nbsp;&nbsp;  COMMAND                  Command run on events
									<br /> &nbsp;&nbsp;  -q,--quiet               Hide non-essential output
									<br /> &nbsp;&nbsp;  -c,--consumer            Pass events as argument to command
									<br /> &nbsp;&nbsp;  -i,--stdin               Pipe events to command
									<br /> &nbsp;&nbsp;  -p,--persist             Pipe events to persistent command
									<br /> &nbsp;&nbsp;  DIRECTORY                Directory to monitor
								</small>
							</code>
						</div>
					</section>
				</section>


				<section>
					<section>
						<h1> Controlling </h1>
						<h1> Processes </h1>
					</section>
					<section>
						<h2>Blocking effectively with MVars</h2>
            <pre class="fragment">
              <code>
          starter :: [String] -&gt; MVar () -&gt; MVar ProcessHandle -&gt; IO ()
          starter args blocker running = do
            putMVar blocker () -- ENSURE WE ARE READY TO ROLL
            p &lt;- startProcess args
            putMVar running p
            code &lt;- waitForProcess p
            case code of ExitFailure 15 -&gt; return () -- Killed!
                         ExitFailure i  -&gt; putStrLn "DOH! [" ++ show i ++ "]"
                         ExitSuccess    -&gt; return ()
              </code>
            </pre>
					</section>
				</section>

				<section>
					<section>
						<h2> Smooth Sailing? </h2>
						<h3 class="fragment"> Not exactly... </h3>
						<br />
						<ul>
							<li class="fragment">Many issues with fsnotify <br />
								<small class="fragment">... once I figured out which library was the right one ...</small></li>
							<li class="fragment">Line buffering... <span class="fragment">FML</span> <br />
								<small class="fragment"><code>commando -c echo | grep <span style="background:red;">--line-buffered</span> Add  | conscript ls</code></small><br />
								<span class="fragment">Remember!!!</span></li>
							<li class="fragment">No ideal interface to process-management <br />
								<small class="fragment">Runtime errors when handle operations are performed on the wrong stream...</small></li>
						</ul>
					</section>
					<section>
						<h2> TODO </h2>
						<h3 class="fragment"> More Options! </h3>
						<br />
						<ul>
							<li class="fragment"> Only emit certain events </li>
							<li class="fragment"> Determine what to spawn using input</li>
						</ul>
					</section>
					<section>
						<h2> TODO </h2>
						<h3 class="fragment"> Fix Bugs! </h3>
						<br />
						<ul>
							<li class="fragment"> Removal events seem to only show pre-existing files</li>
							<li class="fragment"> Handle errors more noisily </li>
						</ul>
					</section>
					<section>
						<h2> TODO </h2>
						<h3 class="fragment"> More Utilities! </h3>
						<br />
						<ul>
							<li class="fragment"> Checksum utility to check for legit changes <span class="fragment">( Medic? )</span> </li>
							<li class="fragment"> Throttle utility to discard spammed events <span class="fragment">( Sapper? )</span> </li>
							<li class="fragment"> Handy composition of existing utilities <span class="fragment">( Admiral? )</span> </li>
						</ul>
					</section>
				</section>

				<section>
					<h1> Questions? </h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});


			var pre_e = {x: 0}

			window.onclick = function(e){
				pre_e = e
				Reveal.next()
				document.body.style.cursor = "none"
			}

			window.onmousemove = function(e){
				var delta = Math.abs(pre_e.x - e.x)
				if(delta > 50) { document.body.style.cursor = "auto" }
			}

		</script>

	</body>
</html>
